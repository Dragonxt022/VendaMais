<!-- Global Toast Container -->
<div id="toast-container" class="fixed top-6 right-6 z-[9999] flex flex-col gap-4 w-full max-w-sm pointer-events-none"></div>

<template id="toast-template">
    <div class="toast-item transform translate-x-full transition-all duration-500 ease-out pointer-events-auto flex items-center p-4 rounded-2xl shadow-2xl border backdrop-blur-md">
        <div class="toast-icon mr-4 flex-shrink-0 w-10 h-10 rounded-xl flex items-center justify-center">
            <!-- Icon will be injected here -->
        </div>
        <div class="flex-1">
            <p class="toast-message text-sm font-bold"></p>
        </div>
        <button class="toast-close ml-4 text-slate-400 hover:text-slate-600 transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
    </div>
</template>

<script>
    (function() {
        const container = document.getElementById('toast-container');
        const template = document.getElementById('toast-template');

        const icons = {
            success: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7" /></svg>`,
            error: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12" /></svg>`,
            warning: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>`,
            info: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`
        };

        const themes = {
            success: {
                bg: 'bg-emerald-50/90 border-emerald-100',
                iconBg: 'bg-emerald-100 text-emerald-600',
                text: 'text-emerald-900'
            },
            error: {
                bg: 'bg-rose-50/90 border-rose-100',
                iconBg: 'bg-rose-100 text-rose-600',
                text: 'text-rose-900'
            },
            warning: {
                bg: 'bg-amber-50/90 border-amber-100',
                iconBg: 'bg-amber-100 text-amber-600',
                text: 'text-amber-900'
            },
            info: {
                bg: 'bg-blue-50/90 border-blue-100',
                iconBg: 'bg-blue-100 text-blue-600',
                text: 'text-blue-900'
            }
        };

        window.notify = function(message, type = 'info', duration = 5000) {
            const clone = template.content.cloneNode(true);
            const item = clone.querySelector('.toast-item');
            const iconContainer = clone.querySelector('.toast-icon');
            const messageEl = clone.querySelector('.toast-message');
            const closeBtn = clone.querySelector('.toast-close');

            const theme = themes[type] || themes.info;

            item.classList.add(...theme.bg.split(' '));
            iconContainer.classList.add(...theme.iconBg.split(' '));
            iconContainer.innerHTML = icons[type] || icons.info;
            messageEl.classList.add(...theme.text.split(' '));
            messageEl.innerText = message;

            container.appendChild(item);

            // Animate In
            requestAnimationFrame(() => {
                item.classList.remove('translate-x-full');
            });

            const removeToast = () => {
                item.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => item.remove(), 500);
            };

            closeBtn.onclick = removeToast;

            if (duration !== Infinity) {
                setTimeout(removeToast, duration);
            }
        };

        // Check for server-side notifications from res.locals.notification
        <% if (locals.notification) { %>
            window.addEventListener('DOMContentLoaded', () => {
                window.notify('<%= notification.message %>', '<%= notification.type %>');
            });
        <% } %>
    })();
</script>
