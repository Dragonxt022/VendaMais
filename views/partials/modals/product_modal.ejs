<!-- Modal Novo Produto -->
<div id="productModal" class="hidden fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-lg shadow-2xl overflow-hidden">
        <div class="p-6 border-b border-slate-100 flex justify-between items-center">
            <h2 class="text-xl font-bold text-slate-900">Cadastrar Produto</h2>
            <button onclick="toggleModal('productModal')" class="text-slate-400 hover:text-slate-600">×</button>
        </div>
        <form action="/app/products" method="POST" class="p-6 grid grid-cols-2 gap-4">
            <div class="col-span-2">
                <label class="block text-sm font-semibold text-slate-700 mb-1">Nome</label>
                <input type="text" name="name" required class="w-full px-4 py-2 rounded-xl border border-slate-200 outline-none focus:border-food-orange transition-all">
            </div>
            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-1">SKU</label>
                <input type="text" name="sku" class="w-full px-4 py-2 rounded-xl border border-slate-200 outline-none focus:border-food-orange transition-all">
            </div>
            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-1">Pç. Venda</label>
                <input type="number" step="0.01" name="price" required class="w-full px-4 py-2 rounded-xl border border-slate-200 outline-none focus:border-food-orange transition-all">
            </div>
            <div class="col-span-2 flex items-center gap-3 p-4 bg-slate-50 rounded-xl border border-slate-100">
                <div class="relative inline-block w-12 h-6 transition duration-200 ease-in-out">
                    <input type="checkbox" name="manage_stock" id="manage_stock" class="peer absolute w-0 h-0 opacity-0" checked onchange="toggleStockFields(this)">
                    <label for="manage_stock" class="block overflow-hidden h-6 rounded-full bg-slate-300 cursor-pointer peer-checked:bg-food-orange transition-colors"></label>
                    <span class="absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-transform peer-checked:translate-x-6"></span>
                </div>
                <label for="manage_stock" class="text-sm font-semibold text-slate-700 cursor-pointer select-none">Gerenciar Estoque deste item?</label>
            </div>

            <div id="stockFields" class="contents">
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-1">Pç. Custo</label>
                    <input type="number" step="0.01" name="cost" required class="w-full px-4 py-2 rounded-xl border border-slate-200 outline-none focus:border-food-orange transition-all">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-1">Estoque Mínimo</label>
                    <input type="number" name="min_stock" class="w-full px-4 py-2 rounded-xl border border-slate-200 outline-none focus:border-food-orange transition-all">
                </div>
            </div>
            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-1">Categoria</label>
                <div class="flex gap-2">
                    <select id="product_category_id" name="category_id" class="w-full px-4 py-2 rounded-xl border border-slate-200 outline-none focus:border-food-orange transition-all">
                        <option value="">Sem Categoria</option>
                        <% if (typeof categories !== 'undefined') { %>
                            <% categories.forEach(c => { %>
                                <option value="<%= c.id %>"><%= c.name %></option>
                            <% }) %>
                        <% } %>
                    </select>
                    <button type="button" onclick="toggleModal('quickCategoryModal')" class="px-3 py-2 bg-slate-100 text-slate-600 rounded-xl hover:bg-slate-200 transition-colors" title="Nova Categoria">+</button>
                </div>
            </div>
            <div class="col-span-2">
                <label class="block text-sm font-semibold text-slate-700 mb-1">Fornecedor Principal</label>
                <div class="flex gap-2">
                    <select id="product_supplier_id" name="supplier_id" class="w-full px-4 py-2 rounded-xl border border-slate-200 outline-none focus:border-food-orange transition-all">
                        <option value="">Sem Fornecedor</option>
                        <% if (typeof suppliers !== 'undefined') { %>
                            <% suppliers.forEach(s => { %>
                                <option value="<%= s.id %>"><%= s.name %></option>
                            <% }) %>
                        <% } %>
                    </select>
                    <button type="button" onclick="toggleModal('quickSupplierModal')" class="px-3 py-2 bg-slate-100 text-slate-600 rounded-xl hover:bg-slate-200 transition-colors" title="Novo Fornecedor">+</button>
                </div>
            </div>
            <div class="col-span-2 pt-4">
                <button type="submit" class="w-full bg-food-orange text-white py-3 rounded-xl font-bold hover:bg-orange-600 shadow-lg shadow-orange-500/20 transition-all">Salvar Produto</button>
            </div>
        </form>
    </div>
</div>
